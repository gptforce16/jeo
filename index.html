<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Litolojik Kesit Oluşturucu</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
    }
    input {
      margin-right: 10px;
    }
    .katman {
      border: 2px solid #000;
      margin-bottom: 4px;
      position: relative;
      color: #000;
      text-align: center;
      overflow: hidden;
    }
    .katman img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.3;
      z-index: 0;
    }
    .katman span {
      position: relative;
      z-index: 2;
      font-weight: bold;
      background: rgba(255,255,255,0.6);
      display: inline-block;
      padding: 2px 8px;
      margin-top: 5px;
    }
    .tools {
      position: absolute;
      right: 5px;
      top: 5px;
      z-index: 3;
    }
    .tools button {
      margin-left: 3px;
    }
    #kesit {
      border: 3px solid #333;
      width: 100%;
      max-width: 400px;
      margin-top: 20px;
      padding: 5px;
    }
  </style>
</head>
<body>

<h2>Litolojik Kesit Oluşturucu</h2>

<div>
  <label>Birim:
    <select id="birim">
      <option>Bitkisel Toprak</option>
      <option>Alüvyon</option>
      <option>Kil</option>
      <option>Silt</option>
      <option>Kum</option>
      <option>Çakıl</option>
      <option>Kireçtaşı</option>
      <option>Şist</option>
      <option>Volkanit</option>
      <option>Metakırıntılı Kayaç</option>
      <option>Granit</option>
    </select>
  </label>
  <label>Başlangıç (m): <input type="number" id="bas" step="0.1"></label>
  <label>Bitiş (m): <input type="number" id="bit" step="0.1"></label>
  <button onclick="ekle()">Katman Ekle</button>
  <button onclick="pdfAl()">PDF Kaydet</button>
</div>

<div id="duzenleForm" style="display:none; margin-top:10px;">
  <h4>Düzenle</h4>
  <label>Birim:
    <select id="d_birim">
      <option>Bitkisel Toprak</option>
      <option>Alüvyon</option>
      <option>Kil</option>
      <option>Silt</option>
      <option>Kum</option>
      <option>Çakıl</option>
      <option>Kireçtaşı</option>
      <option>Şist</option>
      <option>Volkanit</option>
      <option>Metakırıntılı Kayaç</option>
      <option>Granit</option>
    </select>
  </label>
  <label>Başlangıç: <input type="number" id="d_bas" step="0.1"></label>
  <label>Bitiş: <input type="number" id="d_bit" step="0.1"></label>
  <button onclick="kaydetDuzenle()">Kaydet</button>
  <button onclick="iptalDuzenle()">İptal</button>
</div>

<div id="kesit"></div>

<script>
let katmanlar = [];
let seciliIndex = null;

const gorseller = {
  "Bitkisel Toprak": "https://i.imgur.com/YLQSK4K.jpg",
  "Alüvyon": "https://i.imgur.com/XgTFj7K.jpg",
  "Kil": "https://i.imgur.com/ZgWqivA.jpg",
  "Silt": "https://i.imgur.com/Bc0FCtr.jpg",
  "Kum": "https://i.imgur.com/DLU0f1L.jpg",
  "Çakıl": "https://i.imgur.com/3tLxBlj.jpg",
  "Kireçtaşı": "https://i.imgur.com/jhHAvqh.jpg",
  "Şist": "https://i.imgur.com/Es49hcn.jpg",
  "Volkanit": "https://i.imgur.com/S04Wo6h.jpg",
  "Metakırıntılı Kayaç": "https://i.imgur.com/wmwknTX.jpg",
  "Granit": "https://i.imgur.com/jLCpzYo.jpg"
};

function ekle() {
  const birim = document.getElementById('birim').value;
  const bas = parseFloat(document.getElementById('bas').value);
  const bit = parseFloat(document.getElementById('bit').value);
  if (isNaN(bas) || isNaN(bit) || bit <= bas) return alert("Geçersiz derinlik aralığı");
  katmanlar.push({ birim, bas, bit });
  katmanlar.sort((a,b) => a.bas - b.bas);
  guncelleKesit();
}

function guncelleKesit() {
  const kesit = document.getElementById("kesit");
  kesit.innerHTML = "";
  const maxYuk = Math.max(...katmanlar.map(k => k.bit));
  katmanlar.forEach((k, i) => {
    const div = document.createElement("div");
    const yukseklik = ((k.bit - k.bas) / maxYuk) * 500;
    div.className = "katman";
    div.style.height = yukseklik + "px";
    div.style.borderColor = "#444";

    const img = document.createElement("img");
    img.src = gorseller[k.birim] || "";
    div.appendChild(img);

    const span = document.createElement("span");
    span.innerHTML = `${k.bas} - ${k.bit} m<br>${k.birim}`;
    div.appendChild(span);

    const tools = document.createElement("div");
    tools.className = "tools";
    tools.innerHTML = `
      <button onclick="duzenle(${i})">Düzenle</button>
      <button onclick="sil(${i})">Sil</button>
      <button onclick="yukari(${i})">↑</button>
      <button onclick="asagi(${i})">↓</button>`;
    div.appendChild(tools);

    kesit.appendChild(div);
  });
}

function sil(i) {
  if (confirm("Katman silinsin mi?")) {
    katmanlar.splice(i, 1);
    guncelleKesit();
  }
}

function duzenle(i) {
  seciliIndex = i;
  const k = katmanlar[i];
  document.getElementById("d_birim").value = k.birim;
  document.getElementById("d_bas").value = k.bas;
  document.getElementById("d_bit").value = k.bit;
  document.getElementById("duzenleForm").style.display = "block";
}

function kaydetDuzenle() {
  const birim = document.getElementById('d_birim').value;
  const bas = parseFloat(document.getElementById('d_bas').value);
  const bit = parseFloat(document.getElementById('d_bit').value);
  if (isNaN(bas) || isNaN(bit) || bit <= bas) return alert("Geçersiz derinlikler");
  katmanlar[seciliIndex] = { birim, bas, bit };
  katmanlar.sort((a,b) => a.bas - b.bas);
  document.getElementById("duzenleForm").style.display = "none";
  guncelleKesit();
}

function iptalDuzenle() {
  document.getElementById("duzenleForm").style.display = "none";
}

function yukari(i) {
  if (i > 0) {
    [katmanlar[i], katmanlar[i - 1]] = [katmanlar[i - 1], katmanlar[i]];
    guncelleKesit();
  }
}

function asagi(i) {
  if (i < katmanlar.length - 1) {
    [katmanlar[i], katmanlar[i + 1]] = [katmanlar[i + 1], katmanlar[i]];
    guncelleKesit();
  }
}

function pdfAl() {
  const element = document.getElementById("kesit");
  const opt = {
    margin: 0.2,
    filename: 'litolojik_kesit.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).save();
}
</script>

</body>
</html>