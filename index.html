<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Litolojik Kesit Oluşturucu</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #kesitContainer { display: flex; border: 2px solid #333; margin-top: 20px; }
    #kesitCanvas { display: flex; flex-direction: column; width: 150px; border-right: 2px solid #000; }
    .katman {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      border: 2px solid #000;
      margin: 2px 0;
      box-sizing: border-box;
    }
    .katman img {
      height: 100%;
      object-fit: cover;
    }
    .katman span {
      writing-mode: vertical-rl;
      text-align: center;
      padding: 0 4px;
    }
    #form input, select { margin: 5px; }
    #katmanBilgileri { margin-left: 20px; }
    .veriSatiri { margin-bottom: 10px; }
  </style>
</head>
<body>
<h1>Litolojik Kesit Oluşturucu</h1>
<div id="form">
  <select id="litoloji">
    <option value="bitkisel">Bitkisel Toprak</option>
    <option value="aluvyon">Alüvyon</option>
    <option value="kil">Kil</option>
    <option value="silt">Silt</option>
    <option value="kum">Kum</option>
    <option value="cakil">Çakıl</option>
    <option value="kirec">Kireçtaşı</option>
    <option value="sist">Şist</option>
    <option value="volkanit">Volkanit</option>
    <option value="metakirintili">Metakırıntılı</option>
    <option value="granit">Granit</option>
  </select>
  <input type="number" id="baslangic" placeholder="Başlangıç (m)">
  <input type="number" id="bitis" placeholder="Bitiş (m)">
  <button onclick="katmanEkle()">Katman Ekle</button>
  <button onclick="pdfKaydet()">PDF Olarak Kaydet</button>
</div>
<div id="kesitContainer">
  <div id="kesitCanvas"></div>
  <div id="katmanBilgileri"></div>
</div><script>
let katmanlar = [];

const litolojiGorsel = {
  bitkisel: 'https://i.ibb.co/mzX3BqN/bitkisel.jpg',
  aluvyon: 'https://i.ibb.co/5cLT1Rn/aluvyon.jpg',
  kil: 'https://i.ibb.co/TMc9H5k/kil.jpg',
  silt: 'https://i.ibb.co/QYVZJq3/silt.jpg',
  kum: 'https://i.ibb.co/Y02XT7T/kum.jpg',
  cakil: 'https://i.ibb.co/Wx49DQ8/cakil.jpg',
  kirec: 'https://i.ibb.co/JzKjq7C/kirec.jpg',
  sist: 'https://i.ibb.co/SRSdxK5/sist.jpg',
  volkanit: 'https://i.ibb.co/GV0t31j/volkanit.jpg',
  metakirintili: 'https://i.ibb.co/qCZGFhh/metakirintili.jpg',
  granit: 'https://i.ibb.co/b6qrbNp/granit.jpg'
};

function katmanEkle() {
  const litoloji = document.getElementById('litoloji').value;
  let bas = parseFloat(document.getElementById('baslangic').value);
  let bit = parseFloat(document.getElementById('bitis').value);

  if (isNaN(bas) || isNaN(bit) || bit <= bas) {
    alert("Geçerli başlangıç ve bitiş değeri giriniz.");
    return;
  }

  katmanlar.push({ litoloji, bas, bit });
  katmanlar.sort((a, b) => a.bas - b.bas);
  guncelle();

  // Otomatik yeni başlangıç ayarla
  document.getElementById('baslangic').value = bit;
  document.getElementById('bitis').value = bit + 1;
}

function katmanSil(index) {
  katmanlar.splice(index, 1);

  // Bitişten sonra gelenlerin başlangıcını önceki bitişe göre yeniden ayarla
  for (let i = 1; i < katmanlar.length; i++) {
    const onceki = katmanlar[i - 1];
    const suanki = katmanlar[i];
    let yukseklik = suanki.bit - suanki.bas;
    suanki.bas = onceki.bit;
    suanki.bit = suanki.bas + yukseklik;
  }
  guncelle();
}

function guncelle() {
  const canvas = document.getElementById('kesitCanvas');
  const bilgi = document.getElementById('katmanBilgileri');
  canvas.innerHTML = '';
  bilgi.innerHTML = '';
  katmanlar.forEach((katman, i) => {
    const div = document.createElement('div');
    div.className = 'katman';
    const yukseklik = (katman.bit - katman.bas) * 50;
    div.style.height = yukseklik + 'px';

    const img = document.createElement('img');
    img.src = litolojiGorsel[katman.litoloji];
    img.style.width = '100%';

    div.appendChild(img);
    canvas.appendChild(div);

    const vDiv = document.createElement('div');
    vDiv.className = 'veriSatiri';
    vDiv.innerHTML = `
      <strong>${katman.bas.toFixed(1)}–${katman.bit.toFixed(1)} m</strong><br>
      ${katman.litoloji}<br>
      <button onclick="katmanSil(${i})">Sil</button>
    `;
    bilgi.appendChild(vDiv);
  });
}

function pdfKaydet() {
  html2canvas(document.getElementById("kesitContainer")).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
    const pageWidth = 210;
    const pageHeight = 297;
    const ratio = Math.min(pageWidth / canvas.width, pageHeight / canvas.height);
    const imgWidth = canvas.width * ratio;
    const imgHeight = canvas.height * ratio;
    pdf.addImage(imgData, "PNG", 10, 10, imgWidth, imgHeight);
    pdf.save("litolojik_kesit.pdf");
  });
}
</script></body>
</html>