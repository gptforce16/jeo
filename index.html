<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Litolojik Kesit Oluşturucu</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    label, input, select, button {
      margin: 5px 0;
      display: block;
    }
    #container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      align-items: flex-start;
    }
    #kesit {
      border: 3px solid #000;
      width: 200px;
    }
    .katman {
      width: 100%;
      position: relative;
      border: 3px solid;
    }
    .katman img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    #bilgi {
      flex: 1;
      border-left: 2px dashed #888;
      padding-left: 10px;
    }
    .bilgi-item {
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: center;
      border-bottom: 1px solid #ccc;
      box-sizing: border-box;
      padding: 5px;
      cursor: move;
    }
    .sil-btn {
      background: red;
      color: white;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
    }
  </style>
</head>
<body>

<h2>Litolojik Kesit Oluşturucu</h2>

<div>
  <label>Birim:
    <select id="birim">
      <option>Bitkisel Toprak</option>
      <option>Alüvyon</option>
      <option>Kil</option>
      <option>Silt</option>
      <option>Kum</option>
      <option>Çakıl</option>
      <option>Kireçtaşı</option>
      <option>Şist</option>
      <option>Volkanit</option>
      <option>Metakırıntılı Kayaç</option>
      <option>Granit</option>
    </select>
  </label>
  <label>Başlangıç (m): <input type="number" id="bas" step="0.1"></label>
  <label>Bitiş (m): <input type="number" id="bit" step="0.1"></label>
  <button onclick="ekle()">Katman Ekle</button>
  <button onclick="pdfAl()">PDF Kaydet</button>
</div>

<div id="container">
  <div id="kesit"></div>
  <div id="bilgi"></div>
</div>

<script>
const gorseller = {
  "Bitkisel Toprak": "https://i.imgur.com/YLQSK4K.jpg",
  "Alüvyon": "https://i.imgur.com/XgTFj7K.jpg",
  "Kil": "https://i.imgur.com/ZgWqivA.jpg",
  "Silt": "https://i.imgur.com/Bc0FCtr.jpg",
  "Kum": "https://i.imgur.com/DLU0f1L.jpg",
  "Çakıl": "https://i.imgur.com/3tLxBlj.jpg",
  "Kireçtaşı": "https://i.imgur.com/jhHAvqh.jpg",
  "Şist": "https://i.imgur.com/Es49hcn.jpg",
  "Volkanit": "https://i.imgur.com/S04Wo6h.jpg",
  "Metakırıntılı Kayaç": "https://i.imgur.com/wmwknTX.jpg",
  "Granit": "https://i.imgur.com/jLCpzYo.jpg"
};

const renkler = [
  "#FF5733", "#33C1FF", "#33FF57", "#FFC300",
  "#A633FF", "#FF33A1", "#33FFF6", "#B6FF33",
  "#FF8F33", "#8D33FF", "#33FF88"
];

let katmanlar = [];

function ekle() {
  const birim = document.getElementById('birim').value;
  const basInput = document.getElementById('bas');
  const bitInput = document.getElementById('bit');
  const bas = parseFloat(basInput.value);
  const bit = parseFloat(bitInput.value);

  if (isNaN(bas) || isNaN(bit) || bit <= bas) {
    alert("Geçersiz değerler");
    return;
  }

  katmanlar.push({ birim, bas, bit });
  katmanlar.sort((a, b) => a.bas - b.bas);
  guncelle();

  basInput.value = bit;
  bitInput.value = "";
}

function sil(index) {
  katmanlar.splice(index, 1);
  guncelle();
}

function guncelle() {
  const kesit = document.getElementById('kesit');
  const bilgi = document.getElementById('bilgi');
  kesit.innerHTML = '';
  bilgi.innerHTML = '';

  const toplamDerinlik = Math.max(...katmanlar.map(k => k.bit), 1);

  katmanlar.forEach((k, i) => {
    const yuk = ((k.bit - k.bas) / toplamDerinlik) * 600;

    const div = document.createElement('div');
    div.className = 'katman';
    div.style.height = yuk + 'px';
    div.style.borderColor = renkler[i % renkler.length];

    const img = document.createElement('img');
    img.src = gorseller[k.birim] || '';
    div.appendChild(img);
    kesit.appendChild(div);

    const bilgiDiv = document.createElement('div');
    bilgiDiv.className = 'bilgi-item';
    bilgiDiv.setAttribute('draggable', 'true');
    bilgiDiv.style.height = yuk + 'px';
    bilgiDiv.dataset.index = i;
    bilgiDiv.innerHTML = `<div><b>${k.birim}</b><br>${k.bas} - ${k.bit} m</div><button class="sil-btn" onclick="sil(${i})">Sil</button>`;
    bilgi.appendChild(bilgiDiv);
  });

  // Sürükle-bırak sıralama
  bilgi.querySelectorAll('.bilgi-item').forEach(item => {
    item.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', e.target.dataset.index);
    });

    item.addEventListener('dragover', e => e.preventDefault());

    item.addEventListener('drop', e => {
      e.preventDefault();
      const from = +e.dataTransfer.getData('text/plain');
      const to = +e.target.closest('.bilgi-item').dataset.index;
      const moved = katmanlar.splice(from, 1)[0];
      katmanlar.splice(to, 0, moved);
      guncelle();
    });
  });
}

function pdfAl() {
  const element = document.getElementById("container");
  const opt = {
    margin: 0.5,
    filename: 'litolojik_kesit.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
  };
  html2pdf().set(opt).from(element).save();
}
</script>

</body>
</html>