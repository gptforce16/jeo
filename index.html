<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Litolojik Kesit Oluşturucu</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --light: #ecf0f1;
      --dark: #34495e;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
      color: var(--dark);
    }
    
    h2 {
      color: var(--primary);
      border-bottom: 2px solid var(--secondary);
      padding-bottom: 10px;
    }
    
    .control-panel {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      align-items: end;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--primary);
    }
    
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    
    button {
      background-color: var(--secondary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    button.danger {
      background-color: #e74c3c;
    }
    
    #main-container {
      display: flex;
      flex-direction: column;
    }
    
    #section-wrapper {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      position: relative;
    }
    
    #kesit-container {
      flex: 0 0 150px;
      position: relative;
    }
    
    #kesit {
      border: 2px solid var(--dark);
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 150px;
      height: 600px;
    }
    
    .scale-bar {
      position: absolute;
      right: 5px;
      width: 15px;
      height: 100%;
      background: rgba(0,0,0,0.1);
      z-index: 10;
    }
    
    .scale-mark {
      position: absolute;
      right: 0;
      width: 100%;
      text-align: center;
      font-size: 9px;
      color: var(--dark);
      border-top: 1px solid var(--dark);
    }
    
    .katman {
      width: 100%;
      position: absolute;
      left: 0;
      transition: all 0.3s;
    }
    
    .katman:hover {
      opacity: 0.9;
      transform: scaleX(1.02);
    }
    
    .katman-content {
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    .katman-pattern {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.8;
      background-size: 30px 30px;
      background-repeat: repeat;
    }
    
    #info-container {
      flex: 1;
      position: relative;
      height: 600px;
      border-left: 2px solid #ccc;
      padding-left: 20px;
    }
    
    .depth-info {
      position: absolute;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 2px 5px;
      font-size: 12px;
      color: var(--dark);
      pointer-events: none;
    }
    
    .bilgi-item {
      position: absolute;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      padding: 8px 15px;
      background: var(--light);
      border-radius: 4px;
      cursor: move;
      transition: all 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-left: 3px solid var(--secondary);
    }
    
    .bilgi-item:hover {
      background: #d6eaf8;
      transform: translateX(5px);
    }
    
    .bilgi-text {
      flex: 1;
    }
    
    .action-buttons {
      display: flex;
      gap: 5px;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      #section-wrapper {
        flex-direction: column;
      }
      
      #kesit {
        width: 100%;
      }
      
      #info-container {
        height: auto;
        min-height: 200px;
        border-left: none;
        border-top: 2px solid #ccc;
        padding-left: 0;
        padding-top: 10px;
        margin-top: 10px;
      }

      .bilgi-item {
        position: relative;
        margin-bottom: 10px;
      }
      
      .button-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

<h2><i class="fas fa-layer-group"></i> Litolojik Kesit Oluşturucu</h2>

<div class="control-panel">
  <div class="form-grid">
    <div>
      <label for="katmanAdi">Katman Adı:</label>
      <input type="text" id="katmanAdi" placeholder="Örn: Kil, Kumtaşı, vb.">
    </div>
    
    <div>
      <label for="bas">Başlangıç Derinliği (m):</label>
      <input type="number" id="bas" step="0.1" min="0">
    </div>
    
    <div>
      <label for="bit">Bitiş Derinliği (m):</label>
      <input type="number" id="bit" step="0.1" min="0">
    </div>
    
    <div>
      <label for="desen">Desen Stili:</label>
      <select id="desen">
        <option value="solid">Düz Renk</option>
        <option value="stripes">Dikey Çizgili</option>
        <option value="stripes-h">Yatay Çizgili</option>
        <option value="dots">Noktalı</option>
        <option value="dots-large">Büyük Noktalı</option>
        <option value="grid">Kafes</option>
        <option value="crosshatch">Çapraz Kafes</option>
        <option value="zigzag">Zikzak</option>
        <option value="waves">Dalgalı</option>
        <option value="bricks">Tuğla Desen</option>
        <option value="circles">Daireler</option>
        <option value="diamonds">Elmaslar</option>
        <option value="triangles">Üçgenler</option>
        <option value="hexagons">Altıgenler</option>
      </select>
    </div>
    
    <div class="button-group">
      <button id="addBtn"><i class="fas fa-plus"></i> Katman Ekle</button>
      <button id="clearBtn" class="danger"><i class="fas fa-trash"></i> Temizle</button>
      <button id="pdfBtn"><i class="fas fa-file-pdf"></i> PDF Oluştur</button>
    </div>
  </div>
</div>

<div id="main-container">
  <div id="section-wrapper">
    <div id="kesit-container">
      <div id="kesit">
        <div class="scale-bar" id="scaleBar"></div>
      </div>
    </div>
    
    <div id="info-container"></div>
  </div>
</div>

<script>
// Desen stilleri
const desenStilleri = {
  solid: 'none',
  stripes: 'repeating-linear-gradient(0deg, transparent, transparent 5px, currentColor 5px, currentColor 10px)',
  'stripes-h': 'repeating-linear-gradient(90deg, transparent, transparent 5px, currentColor 5px, currentColor 10px)',
  dots: 'radial-gradient(circle, currentColor 2px, transparent 2px)',
  'dots-large': 'radial-gradient(circle, currentColor 3px, transparent 3px)',
  grid: 'linear-gradient(currentColor 1px, transparent 1px), linear-gradient(90deg, currentColor 1px, transparent 1px)',
  crosshatch: `
    linear-gradient(45deg, currentColor 25%, transparent 25%),
    linear-gradient(-45deg, currentColor 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, currentColor 75%),
    linear-gradient(-45deg, transparent 75%, currentColor 75%)`,
  zigzag: 'repeating-linear-gradient(-45deg, currentColor, currentColor 5px, transparent 5px, transparent 10px)',
  waves: 'repeating-linear-gradient(0deg, currentColor, currentColor 3px, transparent 3px, transparent 6px)',
  bricks: `
    linear-gradient(335deg, currentColor 10px, transparent 10px),
    linear-gradient(155deg, currentColor 10px, transparent 10px),
    linear-gradient(335deg, currentColor 10px, transparent 10px),
    linear-gradient(155deg, currentColor 10px, transparent 10px)`,
  circles: 'repeating-radial-gradient(circle, currentColor, currentColor 5px, transparent 5px, transparent 10px)',
  diamonds: 'repeating-linear-gradient(45deg, currentColor, currentColor 5px, transparent 5px, transparent 10px)',
  triangles: 'repeating-linear-gradient(0deg, currentColor, currentColor 10px, transparent 10px, transparent 20px)',
  hexagons: `
    linear-gradient(30deg, currentColor 30%, transparent 30%, transparent 70%, currentColor 70%),
    linear-gradient(-30deg, currentColor 30%, transparent 30%, transparent 70%, currentColor 70%)`
};

let katmanlar = [];

// Buton event listener'ları
document.getElementById('addBtn').addEventListener('click', ekle);
document.getElementById('clearBtn').addEventListener('click', temizle);
document.getElementById('pdfBtn').addEventListener('click', pdfAl);

function ekle() {
  const katmanAdi = document.getElementById('katmanAdi').value;
  const basInput = document.getElementById('bas');
  const bitInput = document.getElementById('bit');
  const desen = document.getElementById('desen').value;
  
  let bas = parseFloat(basInput.value);
  let bit = parseFloat(bitInput.value);

  // Otomatik derinlik ayarı
  if (isNaN(bas)) {
    bas = katmanlar.length > 0 ? katmanlar[katmanlar.length-1].bit : 0;
    basInput.value = bas;
  }
  
  if (isNaN(bit) || bit <= bas) {
    bit = bas + 1.0;
    bitInput.value = bit;
  }

  if (!katmanAdi) {
    alert("Katman adı boş olamaz!");
    return;
  }

  // Rastgele renk oluştur
  const renk = `hsl(${Math.floor(Math.random() * 360)}, 70%, 50%)`;
  
  // Yeni katmanı ekle
  const yeniKatman = {
    ad: katmanAdi,
    bas,
    bit,
    desen,
    renk
  };
  
  katmanlar.push(yeniKatman);
  guncelle();
  
  // Sonraki katman için hazırlık
  basInput.value = bit;
  bitInput.value = "";
  document.getElementById('katmanAdi').value = "";
  document.getElementById('katmanAdi').focus();
}

function temizle() {
  if (confirm("Tüm katmanları silmek istediğinize emin misiniz?")) {
    katmanlar = [];
    guncelle();
  }
}

function sil(index) {
  katmanlar.splice(index, 1);
  guncelle();
}

function getPatternStyle(desen, renk) {
  // Desen stilini oluştur
  return desenStilleri[desen] || 'none';
}

function guncelle() {
  const kesit = document.getElementById('kesit');
  const infoContainer = document.getElementById('info-container');
  const scaleBar = document.getElementById('scaleBar');
  
  // Temizle
  kesit.innerHTML = '<div class="scale-bar" id="scaleBar"></div>';
  infoContainer.innerHTML = '';
  
  if (katmanlar.length === 0) {
    return;
  }
  
  // Toplam derinliği en alttaki katmanın bitiş derinliği olarak ayarla
  const toplamDerinlik = katmanlar.length > 0 ? katmanlar[katmanlar.length-1].bit : 1;
  const olcekAraliklari = getScaleIntervals(toplamDerinlik);
  
  // Ölçek çubuğunu oluştur
  scaleBar.style.height = '100%';
  olcekAraliklari.forEach(derinlik => {
    const yuzde = 100 - (derinlik / toplamDerinlik) * 100;
    const mark = document.createElement('div');
    mark.className = 'scale-mark';
    mark.style.top = `${yuzde}%`;
    mark.textContent = `${derinlik}m`;
    scaleBar.appendChild(mark);
  });
  
  // Katmanları oluştur
  katmanlar.forEach((k, i) => {
    const basYuzde = 100 - (k.bit / toplamDerinlik) * 100;
    const bitYuzde = 100 - (k.bas / toplamDerinlik) * 100;
    const yukseklik = bitYuzde - basYuzde;
    const ortaNokta = basYuzde + (yukseklik / 2);
    
    // Kesit görünümü (SADECE DESEN)
    const katmanDiv = document.createElement('div');
    katmanDiv.className = 'katman';
    katmanDiv.style.top = `${basYuzde}%`;
    katmanDiv.style.height = `${yukseklik}%`;
    
    const katmanContent = document.createElement('div');
    katmanContent.className = 'katman-content';
    
    const katmanPattern = document.createElement('div');
    katmanPattern.className = 'katman-pattern';
    katmanPattern.style.backgroundColor = k.renk;
    katmanPattern.style.backgroundImage = getPatternStyle(k.desen, k.renk);
    
    katmanContent.appendChild(katmanPattern);
    katmanDiv.appendChild(katmanContent);
    kesit.appendChild(katmanDiv);
    
    // Yanda cetvel bilgisi
    const basBilgi = document.createElement('div');
    basBilgi.className = 'depth-info';
    basBilgi.style.top = `${basYuzde}%`;
    basBilgi.innerHTML = `<span>${k.ad}</span><span>${k.bas.toFixed(1)}m</span>`;
    infoContainer.appendChild(basBilgi);
    
    const bitBilgi = document.createElement('div');
    bitBilgi.className = 'depth-info';
    bitBilgi.style.top = `${bitYuzde}%`;
    bitBilgi.innerHTML = `<span>${k.ad}</span><span>${k.bit.toFixed(1)}m</span>`;
    infoContainer.appendChild(bitBilgi);
    
    // Katman bilgisi (orta nokta)
    const bilgiDiv = document.createElement('div');
    bilgiDiv.className = 'bilgi-item';
    bilgiDiv.setAttribute('draggable', 'true');
    bilgiDiv.dataset.index = i;
    bilgiDiv.style.top = `${ortaNokta - 2}%`;
    bilgiDiv.innerHTML = `
      <div class="bilgi-text">
        <strong>${k.ad}</strong> (${(k.bit - k.bas).toFixed(1)}m)
      </div>
      <div class="action-buttons">
        <button class="sil-btn" onclick="event.stopPropagation(); sil(${i})">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    `;
    infoContainer.appendChild(bilgiDiv);
  });
  
  // Sürükle-bırak sıralama
  setupDragAndDrop();
}

function setupDragAndDrop() {
  const infoContainer = document.getElementById('info-container');
  
  infoContainer.querySelectorAll('.bilgi-item').forEach(item => {
    item.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', e.target.dataset.index);
      e.target.style.opacity = '0.5';
    });
    
    item.addEventListener('dragend', e => {
      e.target.style.opacity = '1';
    });
    
    item.addEventListener('dragover', e => {
      e.preventDefault();
      const draggedIndex = e.dataTransfer.getData('text/plain');
      const targetIndex = e.target.closest('.bilgi-item').dataset.index;
      
      if (draggedIndex !== targetIndex) {
        e.target.style.borderTop = '2px solid var(--secondary)';
      }
    });
    
    item.addEventListener('dragleave', e => {
      e.target.style.borderTop = 'none';
    });
    
    item.addEventListener('drop', e => {
      e.preventDefault();
      e.target.style.borderTop = 'none';
      
      const from = +e.dataTransfer.getData('text/plain');
      const to = +e.target.closest('.bilgi-item').dataset.index;
      
      if (from !== to) {
        const moved = katmanlar.splice(from, 1)[0];
        katmanlar.splice(to, 0, moved);
        guncelle();
      }
    });
  });
}

function getScaleIntervals(depth) {
  // Derinliğe göre uygun ölçek aralıklarını belirle
  const interval = depth <= 5 ? 0.5 : 
                  depth <= 20 ? 1 : 
                  depth <= 50 ? 5 : 10;
  
  const intervals = [];
  for (let i = 0; i <= depth; i += interval) {
    intervals.push(i);
  }
  
  if (intervals[intervals.length-1] < depth) {
    intervals.push(depth);
  }
  
  return intervals;
}

function pdfAl() {
  const element = document.getElementById("main-container");
  const opt = {
    margin: 10,
    filename: 'litolojik_kesit.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { 
      scale: 2,
      logging: true,
      letterRendering: true,
      useCORS: true
    },
    jsPDF: { 
      unit: 'mm', 
      format: 'a4', 
      orientation: 'portrait' 
    },
    pagebreak: { mode: 'avoid-all' }
  };
  
  html2pdf().set(opt).from(element).save();
}

// Sayfa yüklendiğinde örnek veri ekle
window.onload = function() {
  // Örnek katmanlar
  katmanlar = [
    { ad: "Bitkisel Toprak", bas: 0, bit: 0.5, desen: "solid", renk: "#8B4513" },
    { ad: "Kil", bas: 0.5, bit: 2.0, desen: "stripes", renk: "#A0522D" },
    { ad: "Kum", bas: 2.0, bit: 4.5, desen: "dots", renk: "#F4A460" },
    { ad: "Kireçtaşı", bas: 4.5, bit: 8.0, desen: "crosshatch", renk: "#C0C0C0" }
  ];
  
  guncelle();
};
</script>

</body>
</html>