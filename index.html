<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeolojik Kesit ve Filtre Analizi</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .input-section, .output-section {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
        }
        .layer-form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: flex-end;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .layer-list {
            margin-top: 20px;
        }
        .layer-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #eee;
            margin-bottom: 5px;
            background-color: #f9f9f9;
        }
        .layer-info {
            flex-grow: 1;
        }
        .layer-actions {
            display: flex;
            gap: 5px;
        }
        .section-container {
            display: flex;
            margin-top: 20px;
            background-color: white;
            padding: 10px;
            border: 1px solid #000;
            position: relative;
            width: 300px;
        }
        .section-legend {
            width: 100px;
            position: relative;
            border: 1px solid #000;
            flex-shrink: 0;
        }
        .section-pattern {
            width: 100px;
            position: relative;
            border: 1px solid #000;
            flex-shrink: 0;
        }
        .section-well {
            width: 100px;
            position: relative;
            border: 1px solid #000;
            flex-shrink: 0;
        }
        .legend-item {
            position: absolute;
            width: 100%;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            padding: 0 5px;
            border-bottom: 1px dashed #ccc;
            font-size: 12px;
        }
        .pattern-layer {
            width: 100%;
            position: absolute;
            left: 0;
        }
        .depth-mark {
            position: absolute;
            left: 0;
            width: 100%;
            border-top: 1px solid #000;
            text-align: center;
            font-size: 10px;
        }
        .depth-label {
            background-color: white;
            padding: 0 5px;
        }
        .filter-zone {
            position: absolute;
            left: 0;
            width: 100%;
            background-color: rgba(0,0,255,0.1);
            border-top: 1px dashed blue;
            border-bottom: 1px dashed blue;
        }
        .filter-label {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 0 5px;
            font-size: 10px;
            color: blue;
            white-space: nowrap;
        }
        .pattern-options {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .pattern-option {
            width: 40px;
            height: 40px;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .pattern-option.selected {
            border: 2px solid #4CAF50;
        }
        .delete-btn { background-color: #f44336; }
        .edit-btn { background-color: #2196F3; }
        .save-btn { background-color: #ff9800; }
        .delete-btn:hover { background-color: #d32f2f; }
        .edit-btn:hover { background-color: #0b7dda; }
        .save-btn:hover { background-color: #e68a00; }

        /* Mobil responsive tasarım */
        @media (max-width: 768px) {
            .section-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 15px;
            }
            .section-legend {
                width: 100px;
            }
            .section-pattern {
                min-width: 100px;
            }
            .section-well {
                width: 100px;
            }
            .section-container::-webkit-scrollbar {
                display: none;
            }
            .layer-form {
                flex-direction: column;
            }
            .pattern-options {
                max-width: 100%;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Jeolojik Kesit ve Filtre Analizi</h1>
        
        <div class="input-section">
            <h2>Katman Bilgileri</h2>
            <div class="layer-form">
                <div class="form-group">
                    <label for="layerName">Katman Adı</label>
                    <input type="text" id="layerName" placeholder="Katman adı girin">
                </div>
                <div class="form-group">
                    <label for="startDepth">Başlangıç Derinliği (m)</label>
                    <input type="number" id="startDepth" placeholder="0" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label for="endDepth">Bitiş Derinliği (m)</label>
                    <input type="number" id="endDepth" placeholder="1.0" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Kayaç Deseni</label>
                    <div class="pattern-options" id="patternOptions">
                        <!-- Desenler JavaScript ile eklenecek -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="filterDepths">Filtre Yerleri (virgülle ayırın)</label>
                    <input type="text" id="filterDepths" placeholder="8, 15, 22">
                </div>
                <button id="addLayerBtn">Katman Ekle</button>
                <button id="updateLayerBtn" style="display:none;">Güncelle</button>
                <button id="cancelEditBtn" style="display:none;">İptal</button>
            </div>
            
            <div class="layer-list" id="layerList">
                <h3>Eklenen Katmanlar</h3>
            </div>
        </div>
        
        <div class="output-section">
            <h2>Jeolojik Kesit</h2>
            <button id="generateSectionBtn">Kesit Oluştur</button>
            <div class="section-container" id="sectionContainer">
                <div class="section-legend" id="sectionLegend"></div>
                <div class="section-pattern" id="sectionPattern"></div>
                <div class="section-well" id="sectionWell"></div>
            </div>
            <div class="save-section" id="saveSection" style="display:none;">
                <button id="saveImageBtn" class="save-btn">Görüntüyü Kaydet</button>
            </div>
        </div>
    </div>

    <script>
        // Desen tanımları
        const patterns = [
            { name: "Kumtaşı", color: "#d2b48c", pattern: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\"><circle cx=\"2\" cy=\"2\" r=\"1\" fill=\"%23d2b48c\"/><circle cx=\"6\" cy=\"2\" r=\"1\" fill=\"%23d2b48c\"/><circle cx=\"4\" cy=\"4\" r=\"1\" fill=\"%23d2b48c\"/><circle cx=\"2\" cy=\"6\" r=\"1\" fill=\"%23d2b48c\"/><circle cx=\"6\" cy=\"6\" r=\"1\" fill=\"%23d2b48c\"/></svg>')" },
            { name: "Kiltaşı", color: "#a0522d", pattern: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\"><rect width=\"8\" height=\"8\" fill=\"%23a0522d\" opacity=\"0.3\"/><path d=\"M0,0 L8,8 M0,8 L8,0\" stroke=\"%23a0522d\" stroke-width=\"0.5\"/></svg>')" },
            { name: "Kireçtaşı", color: "#f5f5dc", pattern: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\"><rect width=\"8\" height=\"8\" fill=\"%23f5f5dc\"/><circle cx=\"4\" cy=\"4\" r=\"2\" fill=\"none\" stroke=\"%238b4513\" stroke-width=\"0.5\"/></svg>')" },
            { name: "Konglomera", color: "#cd853f", pattern: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\"><rect width=\"8\" height=\"8\" fill=\"%23cd853f\"/><circle cx=\"2\" cy=\"2\" r=\"1.5\" fill=\"%238b4513\"/><circle cx=\"6\" cy=\"2\" r=\"1\" fill=\"%238b4513\"/><circle cx=\"3\" cy=\"5\" r=\"0.8\" fill=\"%238b4513\"/><circle cx=\"6\" cy=\"6\" r=\"1.2\" fill=\"%238b4513\"/></svg>')" },
            { name: "Kum", color: "#f4a460", pattern: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\"><rect width=\"8\" height=\"8\" fill=\"%23f4a460\"/><circle cx=\"1\" cy=\"1\" r=\"0.5\" fill=\"%23d2691e\"/><circle cx=\"4\" cy=\"1\" r=\"0.5\" fill=\"%23d2691e\"/><circle cx=\"7\" cy=\"1\" r=\"0.5\" fill=\"%23d2691e\"/><circle cx=\"2\" cy=\"4\" r=\"0.5\" fill=\"%23d2691e\"/><circle cx=\"5\" cy=\"4\" r=\"0.5\" fill=\"%23d2691e\"/><circle cx=\"3\" cy=\"7\" r=\"0.5\" fill=\"%23d2691e\"/><circle cx=\"6\" cy=\"7\" r=\"0.5\" fill=\"%23d2691e\"/></svg>')" }
        ];

        // Seçili desen ve düzenleme durumu
        let selectedPatternIndex = 0;
        let editingLayerIndex = -1;
        const patternOptions = document.getElementById('patternOptions');
        
        // Desen seçeneklerini oluştur
        function createPatternOptions() {
            patternOptions.innerHTML = '';
            patterns.forEach((pattern, index) => {
                const patternDiv = document.createElement('div');
                patternDiv.className = `pattern-option ${index === selectedPatternIndex ? 'selected' : ''}`;
                patternDiv.title = pattern.name;
                patternDiv.style.backgroundImage = pattern.pattern;
                patternDiv.onclick = () => {
                    document.querySelectorAll('.pattern-option').forEach(opt => opt.classList.remove('selected'));
                    patternDiv.classList.add('selected');
                    selectedPatternIndex = index;
                };
                patternOptions.appendChild(patternDiv);
            });
        }
        
        // Sayfa yüklendiğinde desen seçeneklerini oluştur
        createPatternOptions();
        
        // Katman listesi
        const layers = [];
        
        // Katman ekleme fonksiyonu
        document.getElementById('addLayerBtn').onclick = function() {
            addOrUpdateLayer();
        };
        
        // Katman güncelleme fonksiyonu
        document.getElementById('updateLayerBtn').onclick = function() {
            addOrUpdateLayer();
        };
        
        // Düzenleme iptal fonksiyonu
        document.getElementById('cancelEditBtn').onclick = function() {
            cancelEdit();
        };
        
        function addOrUpdateLayer() {
            const layerName = document.getElementById('layerName').value;
            const startDepth = parseFloat(document.getElementById('startDepth').value);
            const endDepth = parseFloat(document.getElementById('endDepth').value);
            
            if (!layerName || isNaN(startDepth) || isNaN(endDepth) || endDepth <= startDepth) {
                alert("Lütfen geçerli katman bilgileri girin (Başlangıç derinliği bitişten küçük olmalı)");
                return;
            }
            
            const layer = {
                name: layerName,
                startDepth: startDepth,
                endDepth: endDepth,
                pattern: patterns[selectedPatternIndex]
            };
            
            if (editingLayerIndex >= 0) {
                // Güncelleme modunda
                layers[editingLayerIndex] = layer;
                cancelEdit();
            } else {
                // Yeni ekleme modunda
                layers.push(layer);
            }
            
            updateLayerList();
            
            // Formu temizle
            document.getElementById('layerName').value = '';
            document.getElementById('startDepth').value = endDepth;
            document.getElementById('endDepth').value = '';
            selectedPatternIndex = 0;
            createPatternOptions();
        }
        
        function cancelEdit() {
            editingLayerIndex = -1;
            document.getElementById('addLayerBtn').style.display = 'inline-block';
            document.getElementById('updateLayerBtn').style.display = 'none';
            document.getElementById('cancelEditBtn').style.display = 'none';
            
            // Formu temizle
            document.getElementById('layerName').value = '';
            document.getElementById('startDepth').value = '';
            document.getElementById('endDepth').value = '';
            selectedPatternIndex = 0;
            createPatternOptions();
        }
        
        // Katman listesini güncelle
        function updateLayerList() {
            const layerList = document.getElementById('layerList');
            layerList.innerHTML = '<h3>Eklenen Katmanlar</h3>';
            
            if (layers.length === 0) {
                layerList.innerHTML += '<p>Henüz katman eklenmedi</p>';
                return;
            }
            
            layers.forEach((layer, index) => {
                const layerItem = document.createElement('div');
                layerItem.className = 'layer-item';
                layerItem.innerHTML = `
                    <div class="layer-info">
                        <strong>${layer.name}</strong> - 
                        ${layer.startDepth}m - ${layer.endDepth}m (${(layer.endDepth - layer.startDepth).toFixed(1)}m) - 
                        ${layer.pattern.name}
                    </div>
                    <div class="layer-actions">
                        <button class="edit-btn" data-index="${index}">Düzenle</button>
                        <button class="delete-btn" data-index="${index}">Sil</button>
                    </div>
                `;
                layerList.appendChild(layerItem);
            });
            
            // Silme butonlarına event ekle
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.onclick = function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    layers.splice(index, 1);
                    updateLayerList();
                    
                    if (editingLayerIndex === index) {
                        cancelEdit();
                    } else if (editingLayerIndex > index) {
                        editingLayerIndex--;
                    }
                };
            });
            
            // Düzenle butonlarına event ekle
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.onclick = function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const layer = layers[index];
                    
                    // Formu doldur
                    document.getElementById('layerName').value = layer.name;
                    document.getElementById('startDepth').value = layer.startDepth;
                    document.getElementById('endDepth').value = layer.endDepth;
                    
                    // Deseni seç
                    selectedPatternIndex = patterns.findIndex(p => p.name === layer.pattern.name);
                    createPatternOptions();
                    
                    // Düzenleme moduna geç
                    editingLayerIndex = index;
                    document.getElementById('addLayerBtn').style.display = 'none';
                    document.getElementById('updateLayerBtn').style.display = 'inline-block';
                    document.getElementById('cancelEditBtn').style.display = 'inline-block';
                };
            });
        }
        
        // Filtre derinliklerini parse et
        function parseFilterDepths() {
            const filterInput = document.getElementById('filterDepths').value;
            if (!filterInput.trim()) return [];
            
            return filterInput.split(',')
                .map(item => parseFloat(item.trim()))
                .filter(item => !isNaN(item));
        }
        
        // Kesit oluşturma fonksiyonu
        document.getElementById('generateSectionBtn').onclick = function() {
            if (layers.length === 0) {
                alert("Lütfen önce katman ekleyin");
                return;
            }
            
            // Katmanları derinliğe göre sırala
            layers.sort((a, b) => a.startDepth - b.startDepth);
            
            const sectionLegend = document.getElementById('sectionLegend');
            const sectionPattern = document.getElementById('sectionPattern');
            const sectionWell = document.getElementById('sectionWell');
            
            sectionLegend.innerHTML = '';
            sectionPattern.innerHTML = '';
            sectionWell.innerHTML = '';
            
            // Ölçek faktörü (piksel/metre)
            const scaleFactor = 20;
            const sectionHeight = layers[layers.length - 1].endDepth * scaleFactor;
            
            sectionPattern.style.height = `${sectionHeight}px`;
            sectionLegend.style.height = `${sectionHeight}px`;
            sectionWell.style.height = `${sectionHeight}px`;
            
            // Filtre bölgelerini al
            const filterDepths = parseFilterDepths();
            
            // Filtre bölgelerini KUYU LOGUNA çiz
            filterDepths.forEach(depth => {
                const filterTop = depth * scaleFactor;
                const filterHeight = 4 * scaleFactor;
                
                // Filtre bölgesi
                const filterZone = document.createElement('div');
                filterZone.className = 'filter-zone';
                filterZone.style.top = `${filterTop}px`;
                filterZone.style.height = `${filterHeight}px`;
                sectionWell.appendChild(filterZone);
                
                // Filtre etiketi
                const filterLabel = document.createElement('div');
                filterLabel.className = 'filter-label';
                filterLabel.style.top = `${filterTop + filterHeight/2}px`;
                filterLabel.innerHTML = `Filtre ${depth}-${depth+4}m`;
                sectionWell.appendChild(filterLabel);
            });
            
            // Katmanları çiz
            layers.forEach((layer, index) => {
                const layerHeight = (layer.endDepth - layer.startDepth) * scaleFactor;
                const layerTop = layer.startDepth * scaleFactor;
                
                // 1. Lejant Kısmı
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.style.height = `${layerHeight}px`;
                legendItem.style.top = `${layerTop}px`;
                legendItem.innerHTML = `
                    <div><strong>${layer.name}</strong></div>
                    <div>${layer.startDepth}m - ${layer.endDepth}m</div>
                `;
                sectionLegend.appendChild(legendItem);
                
                // 2. Jeolojik Kesit
                const patternLayer = document.createElement('div');
                patternLayer.className = 'pattern-layer';
                patternLayer.style.height = `${layerHeight}px`;
                patternLayer.style.top = `${layerTop}px`;
                patternLayer.style.backgroundImage = layer.pattern.pattern;
                sectionPattern.appendChild(patternLayer);
                
                // Derinlik işaretleri
                const depthMark = document.createElement('div');
                depthMark.className = 'depth-mark';
                depthMark.style.top = `${layerTop}px`;
                depthMark.innerHTML = `<span class="depth-label">${layer.startDepth}m</span>`;
                sectionPattern.appendChild(depthMark);
                
                // Son katmanın bitiş derinliği
                if (index === layers.length - 1) {
                    const endMark = document.createElement('div');
                    endMark.className = 'depth-mark';
                    endMark.style.top = `${layer.endDepth * scaleFactor}px`;
                    endMark.innerHTML = `<span class="depth-label">${layer.endDepth}m</span>`;
                    sectionPattern.appendChild(endMark);
                }
            });
            
            document.getElementById('saveSection').style.display = 'block';
        };
        
        // Görüntüyü kaydet
        document.getElementById('saveImageBtn').onclick = function() {
            html2canvas(document.getElementById('sectionContainer')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'jeolojik-kesit-ve-filtreler.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        };
    </script>
</body>
</html>